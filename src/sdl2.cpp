////////////////////////////////////////////////////////////////////////////////
// Retro - Retro Computing Library
// Copyright (c) 2023 Ryan Clarke
////////////////////////////////////////////////////////////////////////////////

#include "retro/sdl2.hpp"

#include <SDL2/SDL.h>

#include <stdexcept>
#include <utility>


////////////////////////////////////////////////////////////////////////////////
namespace retro
{

////////////////////////////////////////////////////////////////////////////////
sdl2::sdl2(const subsystem flags)
{
    if(SDL_Init(std::to_underlying(flags)) != 0)
    {
        throw std::runtime_error(SDL_GetError());
    }
}


////////////////////////////////////////////////////////////////////////////////
sdl2::~sdl2()
{
    SDL_Quit();
}


////////////////////////////////////////////////////////////////////////////////
void sdl2::init_subsystem(const subsystem flags) const
{
    if(SDL_InitSubSystem(std::to_underlying(flags)) != 0)
    {
        throw std::runtime_error(SDL_GetError());
    }
}


////////////////////////////////////////////////////////////////////////////////
sdl2::subsystem sdl2::was_init(const subsystem flags) const noexcept
{
    return sdl2::subsystem{SDL_WasInit(std::to_underlying(flags))};
}


////////////////////////////////////////////////////////////////////////////////
void sdl2::quit_subsystem(const subsystem flags) const noexcept
{
    SDL_QuitSubSystem(std::to_underlying(flags));
}


////////////////////////////////////////////////////////////////////////////////
constexpr sdl2::subsystem operator|(const sdl2::subsystem lhs, const sdl2::subsystem rhs)
{
    return sdl2::subsystem{std::to_underlying(lhs) | std::to_underlying(rhs)};
}


////////////////////////////////////////////////////////////////////////////
constexpr sdl2::subsystem operator&(const sdl2::subsystem lhs, const sdl2::subsystem rhs)
{
    return sdl2::subsystem{std::to_underlying(lhs) & std::to_underlying(rhs)};
}

}   // retro
